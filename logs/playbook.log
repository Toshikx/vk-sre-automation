Started by user Isaev Antonio
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/jenkins_home/workspace/RunPlaybook
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Checkut)
[Pipeline] git
The recommended git tool is: NONE
No credentials specified
Cloning the remote Git repository
Cloning repository https://github.com/Toshikx/vk-sre-automation
 > git init /var/jenkins_home/workspace/RunPlaybook # timeout=10
Fetching upstream changes from https://github.com/Toshikx/vk-sre-automation
 > git --version # timeout=10
 > git --version # 'git version 2.30.2'
 > git fetch --tags --force --progress -- https://github.com/Toshikx/vk-sre-automation +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git config remote.origin.url https://github.com/Toshikx/vk-sre-automation # timeout=10
 > git config --add remote.origin.fetch +refs/heads/*:refs/remotes/origin/* # timeout=10
Avoid second fetch
 > git rev-parse refs/remotes/origin/main^{commit} # timeout=10
Checking out Revision 5066c635e64a244182259e721a871e81523b2e3c (refs/remotes/origin/main)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 5066c635e64a244182259e721a871e81523b2e3c # timeout=10
 > git branch -a -v --no-abbrev # timeout=10
 > git checkout -b main 5066c635e64a244182259e721a871e81523b2e3c # timeout=10
Commit message: "add Jenkinsfile"
 > git rev-list --no-walk 5066c635e64a244182259e721a871e81523b2e3c # timeout=10
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Deploy)
[Pipeline] git
The recommended git tool is: NONE
No credentials specified
 > git rev-parse --resolve-git-dir /var/jenkins_home/workspace/RunPlaybook/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/Toshikx/vk-sre-automation # timeout=10
Fetching upstream changes from https://github.com/Toshikx/vk-sre-automation
 > git --version # timeout=10
 > git --version # 'git version 2.30.2'
 > git fetch --tags --force --progress -- https://github.com/Toshikx/vk-sre-automation +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/main^{commit} # timeout=10
Checking out Revision 5066c635e64a244182259e721a871e81523b2e3c (refs/remotes/origin/main)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 5066c635e64a244182259e721a871e81523b2e3c # timeout=10
 > git branch -a -v --no-abbrev # timeout=10
 > git branch -D main # timeout=10
 > git checkout -b main 5066c635e64a244182259e721a871e81523b2e3c # timeout=10
Commit message: "add Jenkinsfile"
[Pipeline] sh
+ pwd
/var/jenkins_home/workspace/RunPlaybook
[Pipeline] sh
+ ls -al
total 28
drwxr-xr-x 4 jenkins jenkins 4096 May 10 15:43 .
drwxr-xr-x 6 jenkins jenkins 4096 May 10 15:43 ..
drwxr-xr-x 8 jenkins jenkins 4096 May 10 15:43 .git
-rw-r--r-- 1 jenkins jenkins 4719 May 10 15:43 Jenkinsfile
-rw-r--r-- 1 jenkins jenkins   19 May 10 15:43 README.md
drwxr-xr-x 5 jenkins jenkins 4096 May 10 15:43 role
[Pipeline] sh
+ ls -al ./role
total 40
drwxr-xr-x 5 jenkins jenkins 4096 May 10 15:43 .
drwxr-xr-x 4 jenkins jenkins 4096 May 10 15:43 ..
drwxr-xr-x 5 jenkins jenkins 4096 May 10 15:43 apache
-rw-r--r-- 1 jenkins jenkins  295 May 10 15:43 hosts.yml
-rw-r--r-- 1 jenkins jenkins   14 May 10 15:43 lampstack.retry
-rw-r--r-- 1 jenkins jenkins  359 May 10 15:43 lampstack.yml
drwxr-xr-x 3 jenkins jenkins 4096 May 10 15:43 mariadb
-rw-r--r-- 1 jenkins jenkins   18 May 10 15:43 provision.retry
-rw-r--r-- 1 jenkins jenkins  261 May 10 15:43 provision.yml
drwxr-xr-x 2 jenkins jenkins 4096 May 10 15:43 vars
[Pipeline] sh
+ echo /opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
/opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
[Pipeline] dir
Running in /var/jenkins_home/workspace/RunPlaybook/role
[Pipeline] {
[Pipeline] ansiColor
[Pipeline] {

[Pipeline] ansiblePlaybook
[role] $ ansible-playbook lampstack.yml -i hosts.yml --private-key /var/jenkins_home/workspace/RunPlaybook/role/ssh6924772687968046209.key -u tony --timeout=60

PLAY [Install Python] **********************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [lampstack][0m

TASK [Install Python] **********************************************************
[0;32mok: [lampstack][0m

PLAY [configure lamp] **********************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [lampstack][0m

TASK [apache : Install prerequisites] ******************************************
[0;32mok: [lampstack] => (item=aptitude)[0m

TASK [apache : Install Apache and PHP Packages] ********************************
[0;32mok: [lampstack] => (item=apache2)[0m
[0;32mok: [lampstack] => (item=php)[0m
[0;32mok: [lampstack] => (item=php-mysql)[0m
[0;32mok: [lampstack] => (item=libapache2-mod-php)[0m

TASK [apache : Create document root] *******************************************
[0;32mok: [lampstack][0m

TASK [apache : Set up Apache virtualhost] **************************************
[0;32mok: [lampstack][0m

TASK [apache : Enable new site] ************************************************
[0;33mchanged: [lampstack][0m

TASK [apache : Disable default Apache site] ************************************
[0;33mchanged: [lampstack][0m

TASK [apache : UFW - Allow HTTP on port 80] ************************************
[0;32mok: [lampstack][0m

TASK [apache : Sets Up PHP Info Page] ******************************************
[0;32mok: [lampstack][0m

TASK [apache : Reload Apache] **************************************************
[0;33mchanged: [lampstack][0m

TASK [apache : Restart Apache] *************************************************
[0;33mchanged: [lampstack][0m

TASK [mariadb : Install prerequisites] *****************************************
[0;32mok: [lampstack] => (item=aptitude)[0m

TASK [mariadb : Install MariaDB Packages] **************************************
[0;32mok: [lampstack] => (item=mariadb-server)[0m
[0;32mok: [lampstack] => (item=python3-pymysql)[0m

TASK [mariadb : Start MariaDB service] *****************************************
[0;32mok: [lampstack][0m

TASK [mariadb : Sets the root password] ****************************************
[0;32mok: [lampstack][0m

TASK [mariadb : Removes all anonymous user accounts] ***************************
[0;32mok: [lampstack][0m

TASK [mariadb : Removes the MySQL test database] *******************************
[0;32mok: [lampstack][0m

RUNNING HANDLER [apache : Reload Apache] ***************************************
[0;33mchanged: [lampstack][0m

PLAY RECAP *********************************************************************
[0;33mlampstack[0m                  : [0;32mok=20  [0m [0;33mchanged=5   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

[Pipeline] }

[Pipeline] // ansiColor
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Check Database)
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ grep -c Unknown database
+ mysql -h 158.160.25.14 -P 3306 -u root -pP@ssw0rd -e USE export
0
[Pipeline] echo
Database exists
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS
